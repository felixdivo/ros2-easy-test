name: Python package

on: [push]

# NOTE: Keep this file in sync with the Dockerfile in the root directory

jobs:
  build:
    defaults:
      run:
        shell: bash

    runs-on: ubuntu-latest
    strategy:
      matrix:
        # TODO: add ros:iron-ros-core when it is available; check if earlier versions can easily be supported
        include:
          - container: "ros:humble-ros-core"
            python-version: "3.10"
          - container: "ros:rolling-ros-core"
            python-version: "3.10"
          - container: "ros:rolling-ros-core"
            python-version: "3.11"
          - container: "ros:rolling-ros-core"
            python-version: "3.12.0-alpha.7"
    container: ${{ matrix.container }}

    steps:
      - 
        name: Checkout repository
        uses: actions/checkout@v3
      -
        name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}
      -
        name: Install dependencies
        run: |
          apt-get update -q && apt-get install -qy ros-$ROS_DISTRO-example-interfaces
          source /opt/ros/$ROS_DISTRO/setup.bash
          ros2 --help
      - #pip install -e .[dev]
        name: Check dependencies
        run: ros2 --help
      - run: |
          pytest --collect-only
      -
        name: Testing (with pytest)
        run: |
          pytest
    #   -
    #     name: Lint with ruff
    #     run: |
    #       # stop the build if there are Python syntax errors or undefined names
    #       ruff --format=github --select=E9,F63,F7,F82 --target-version=py37 .
    #       # default set of ruff rules with GitHub Annotations
    #       ruff --format=github --target-version=py37 .
